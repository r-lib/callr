<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Call R from R — callr-package • callr</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.9/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.9/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Call R from R — callr-package"><meta name="description" content="It is sometimes useful to perform a computation in a separate
R process, without affecting the current R process at all.  This
packages does exactly that."><meta property="og:description" content="It is sometimes useful to perform a computation in a separate
R process, without affecting the current R process at all.  This
packages does exactly that."><meta name="robots" content="noindex"><script defer data-domain="callr.r-lib.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script></head><body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">callr</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">3.7.6.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><h6 class="dropdown-header" data-toc-skip>Tutorials</h6></li>
    <li><a class="dropdown-item" href="../articles/r-session.html">Persistent R sessions</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Blog posts</h6></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2019/09/callr-task-q">A multi process task queue in 100 lines of R code</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-lib/callr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Call R from R</h1>
      <small class="dont-index">Source: <a href="https://github.com/r-lib/callr/blob/main/R/callr-package.R" class="external-link"><code>R/callr-package.R</code></a></small>
      <div class="d-none name"><code>callr-package.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>It is sometimes useful to perform a computation in a separate
R process, without affecting the current R process at all.  This
packages does exactly that.</p>
    </div>


    <div class="section level2">
    <h2 id="callr">callr<a class="anchor" aria-label="anchor" href="#callr"></a></h2>

<div class="section">
<h3 id="features">Features<a class="anchor" aria-label="anchor" href="#features"></a></h3>

<ul><li><p>Calls an R function, with arguments, in a subprocess.</p></li>
<li><p>Copies function arguments to the subprocess and copies the return value of the function back, seamlessly.</p></li>
<li><p>Copies error objects back from the subprocess, including a stack trace.</p></li>
<li><p>Shows and/or collects the standard output and standard error of the subprocess.</p></li>
<li><p>Supports both one-off and persistent R subprocesses.</p></li>
<li><p>Calls the function synchronously or asynchronously (in the background).</p></li>
<li><p>Can call <code>R CMD</code> commands, synchronously or asynchronously.</p></li>
<li><p>Can call R scripts, synchronously or asynchronously.</p></li>
<li><p>Provides extensible <code>r_process</code>, <code>rcmd_process</code> and <code>rscript_process</code> R6 classes, based on <code><a href="http://processx.r-lib.org/reference/process.html" class="external-link">processx::process</a></code>.</p></li>
</ul></div>

<div class="section">
<h3 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a></h3>


<p>Install the stable version from CRAN:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"callr"</span><span class="op">)</span></span></code></pre><p></p></div>
<p>Install the development version from GitHub:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pak.html" class="external-link">pak</a></span><span class="op">(</span><span class="st">"r-lib/callr"</span><span class="op">)</span></span></code></pre><p></p></div>
</div>

<div class="section">
<h3 id="synchronous-one-off-r-processes">Synchronous, one-off R processes<a class="anchor" aria-label="anchor" href="#synchronous-one-off-r-processes"></a></h3>


<p>Use <code><a href="r.html">r()</a></code> to run an R function in a new R process.
The results are passed back seamlessly:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu">callr</span><span class="fu">::</span><span class="fu"><a href="../reference/r.html">r</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">iris</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre><p></p></div>
<div class="asciicast" style="color: #172431;font-family: 'Fira Code',Monaco,Consolas,Menlo,'Bitstream Vera Sans Mono','Powerline Symbols',monospace;line-height: 1.300000"><div class="sourceCode"><pre>
#&gt;              Sepal.Length Sepal.Width Petal.Length Petal.Width
#&gt; Sepal.Length    0.6856935  -0.0424340    1.2743154   0.5162707
#&gt; Sepal.Width    -0.0424340   0.1899794   -0.3296564  -0.1216394
#&gt; Petal.Length    1.2743154  -0.3296564    3.1162779   1.2956094
#&gt; Petal.Width     0.5162707  -0.1216394    1.2956094   0.5810063
</pre></div></div>
<div class="section">
<h4 id="passing-arguments">Passing arguments<a class="anchor" aria-label="anchor" href="#passing-arguments"></a></h4>


<p>You can pass arguments to the function by setting <code>args</code> to the list of arguments.
This is often necessary as these arguments are explicitly copied to the child process, whereas the evaluated function cannot refer to variables in the parent.
For example, the following does not work:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">mycars</span> <span class="op">&lt;-</span> <span class="va">cars</span></span>
<span><span class="fu">callr</span><span class="fu">::</span><span class="fu"><a href="../reference/r.html">r</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mycars</span><span class="op">)</span><span class="op">)</span></span></code></pre><p></p></div>
<div class="asciicast" style="color: #172431;font-family: 'Fira Code',Monaco,Consolas,Menlo,'Bitstream Vera Sans Mono','Powerline Symbols',monospace;line-height: 1.300000"><div class="sourceCode"><pre>
#&gt; <span style="font-weight: bold;color: #B58900;">Error</span>:
#&gt; <span style="color: #B58900;">!</span> in callr subprocess.
#&gt; <span style="font-weight: bold;">Caused by error</span> in `summary(mycars)`:
#&gt; <span style="color: #B58900;">!</span> object 'mycars' not found
#&gt; <span style="color: #525252;">Type .Last.error to see the more details.</span>
</pre></div></div>

<p>But this does:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">mycars</span> <span class="op">&lt;-</span> <span class="va">cars</span></span>
<span><span class="fu">callr</span><span class="fu">::</span><span class="fu"><a href="../reference/r.html">r</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">mycars</span><span class="op">)</span><span class="op">)</span></span></code></pre><p></p></div>
<div class="asciicast" style="color: #172431;font-family: 'Fira Code',Monaco,Consolas,Menlo,'Bitstream Vera Sans Mono','Powerline Symbols',monospace;line-height: 1.300000"><div class="sourceCode"><pre>
#&gt;      speed           dist
#&gt;  Min.   : 4.0   Min.   :  2.00
#&gt;  1st Qu.:12.0   1st Qu.: 26.00
#&gt;  Median :15.0   Median : 36.00
#&gt;  Mean   :15.4   Mean   : 42.98
#&gt;  3rd Qu.:19.0   3rd Qu.: 56.00
#&gt;  Max.   :25.0   Max.   :120.00
</pre></div></div>

<p>Note that the arguments will be serialized and saved to a file, so if they are large R objects, it might take a long time for the child process to start up.</p>
</div>

<div class="section">
<h4 id="using-packages">Using packages<a class="anchor" aria-label="anchor" href="#using-packages"></a></h4>


<p>You can use any R package in the child process, just make sure to refer to it explicitly with the <code>::</code> operator.
For example, the following code creates an <a href="https://github.com/igraph/rigraph" class="external-link">igraph</a> graph in the child, and calculates some metrics of it.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu">callr</span><span class="fu">::</span><span class="fu"><a href="../reference/r.html">r</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span> <span class="va">g</span> <span class="op">&lt;-</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://r.igraph.org/reference/sample_gnp.html" class="external-link">sample_gnp</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">4</span><span class="op">/</span><span class="fl">1000</span><span class="op">)</span>; <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://r.igraph.org/reference/diameter.html" class="external-link">diameter</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="op">}</span><span class="op">)</span></span></code></pre><p></p></div>
<div class="asciicast" style="color: #172431;font-family: 'Fira Code',Monaco,Consolas,Menlo,'Bitstream Vera Sans Mono','Powerline Symbols',monospace;line-height: 1.300000"><div class="sourceCode"><pre>
#&gt; [1] 11
</pre></div></div>
</div>

<div class="section">
<h4 id="error-handling">Error handling<a class="anchor" aria-label="anchor" href="#error-handling"></a></h4>


<p>callr copies errors from the child process back to the main R session:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu">callr</span><span class="fu">::</span><span class="fu"><a href="../reference/r.html">r</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fl">1</span> <span class="op">+</span> <span class="st">"A"</span><span class="op">)</span></span></code></pre><p></p></div>
<div class="asciicast" style="color: #172431;font-family: 'Fira Code',Monaco,Consolas,Menlo,'Bitstream Vera Sans Mono','Powerline Symbols',monospace;line-height: 1.300000"><div class="sourceCode"><pre>
#&gt; <span style="font-weight: bold;color: #B58900;">Error</span>:
#&gt; <span style="color: #B58900;">!</span> in callr subprocess.
#&gt; <span style="font-weight: bold;">Caused by error</span> in `1 + "A"`:
#&gt; <span style="color: #B58900;">!</span> non-numeric argument to binary operator
#&gt; <span style="color: #525252;">Type .Last.error to see the more details.</span>
</pre></div></div>
callr sets the `.Last.error` variable, and after an error you can inspect this for more details about the error, including stack traces both from the main R process and the subprocess.

<p></p><div class="sourceCode r"><pre><code><span><span class="va">.Last.error</span></span></code></pre><p></p></div>
<div class="asciicast" style="color: #172431;font-family: 'Fira Code',Monaco,Consolas,Menlo,'Bitstream Vera Sans Mono','Powerline Symbols',monospace;line-height: 1.300000"><div class="sourceCode"><pre>
#&gt; <span style="font-weight: bold;color: #B58900;">Error</span>:
#&gt; <span style="color: #B58900;">!</span> in callr subprocess.
#&gt; <span style="font-weight: bold;">Caused by error</span> in `1 + "A"`:
#&gt; <span style="color: #B58900;">!</span> non-numeric argument to binary operator
#&gt; ---
#&gt; Backtrace:
#&gt; <span style="color: #525252;">1. </span>callr::<span style="color: #2AA198;">r</span><span style="color: #B58900;">(</span><span style="color: #DC322F;">function</span><span style="color: #268BD2;">()</span> <span style="color: #268BD2;">1</span> <span style="color: #859900;">+</span> <span style="color: #B58900;">"A")</span>
#&gt; <span style="color: #525252;">2. </span>callr:::<span style="color: #2AA198;">get_result</span><span style="color: #B58900;">(</span>output = out, options<span style="color: #B58900;">)</span>
#&gt; <span style="color: #525252;">3. </span>callr:::<span style="color: #2AA198;">throw</span><span style="color: #B58900;">(</span><span style="color: #2AA198;">callr_remote_error</span><span style="color: #268BD2;">(</span>remerr, output<span style="color: #268BD2;">)</span>, parent = <span style="color: #2AA198;">fix_msg</span><span style="color: #268BD2;">(</span>remerr<span style="color: #2AA198;">[[</span><span style="color: #268BD2;">3</span><span style="color: #2AA198;">]</span>
#&gt; <span style="color: #2AA198;">]</span><span style="color: #268BD2;">)</span><span style="color: #B58900;">)</span>
#&gt; ---
#&gt; Subprocess backtrace:
#&gt; <span style="color: #525252;">1. </span>base::.handleSimpleError(function (e) …
#&gt; <span style="color: #525252;">2. </span>global <span style="color: #2AA198;">h</span><span style="color: #B58900;">(</span><span style="color: #2AA198;">simpleError</span><span style="color: #268BD2;">(</span>msg, call<span style="color: #268BD2;">)</span><span style="color: #B58900;">)</span>
</pre></div></div>

<p>The error objects has two parts.
The first belongs to the main process, and the second belongs to the subprocess.</p>
<p><code>.Last.error</code> also includes a stack trace, that includes both the main R process and the subprocess:</p>
<p>The top part of the trace contains the frames in the main process, and the bottom part contains the frames in the subprocess, starting with the anonymous function.</p>
</div>

<div class="section">
<h4 id="standard-output-and-error">Standard output and error<a class="anchor" aria-label="anchor" href="#standard-output-and-error"></a></h4>


<p>By default, the standard output and error of the child is lost, but you can request callr to redirect them to files, and then inspect the files in the parent:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">callr</span><span class="fu">::</span><span class="fu"><a href="../reference/r.html">r</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"hello world!"</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"hello again!"</span><span class="op">)</span> <span class="op">}</span>,</span>
<span>  stdout <span class="op">=</span> <span class="st">"/tmp/out"</span>, stderr <span class="op">=</span> <span class="st">"/tmp/err"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="st">"/tmp/out"</span><span class="op">)</span></span></code></pre><p></p></div>
<div class="asciicast" style="color: #172431;font-family: 'Fira Code',Monaco,Consolas,Menlo,'Bitstream Vera Sans Mono','Powerline Symbols',monospace;line-height: 1.300000"><div class="sourceCode"><pre>
#&gt; [1] "[1] \"hello world!\""
</pre></div></div>

<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="st">"/tmp/err"</span><span class="op">)</span></span></code></pre><p></p></div>
<div class="asciicast" style="color: #172431;font-family: 'Fira Code',Monaco,Consolas,Menlo,'Bitstream Vera Sans Mono','Powerline Symbols',monospace;line-height: 1.300000"><div class="sourceCode"><pre>
#&gt; [1] "hello again!"
</pre></div></div>

<p>With the <code>stdout</code> option, the standard output is collected and can be examined once the child process finished.
The <code>show = TRUE</code> options will also show the output of the child, as it is printed, on the console of the parent.</p>
</div>


</div>

<div class="section">
<h3 id="background-r-processes">Background R processes<a class="anchor" aria-label="anchor" href="#background-r-processes"></a></h3>


<p><code><a href="r_bg.html">r_bg()</a></code> is similar to <code><a href="r.html">r()</a></code> but it starts the R process in the background.
It returns an <code>r_process</code> R6 object, that provides a rich API:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">rp</span> <span class="op">&lt;-</span> <span class="fu">callr</span><span class="fu">::</span><span class="fu"><a href="../reference/r_bg.html">r_bg</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">.2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rp</span></span></code></pre><p></p></div>
<div class="asciicast" style="color: #172431;font-family: 'Fira Code',Monaco,Consolas,Menlo,'Bitstream Vera Sans Mono','Powerline Symbols',monospace;line-height: 1.300000"><div class="sourceCode"><pre>
#&gt; PROCESS 'R', running, pid 58242.
</pre></div></div>

<p>This is a list of all <code>r_process</code> methods:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="https://rdrr.io/r/base/ls.html" class="external-link">ls</a></span><span class="op">(</span><span class="va">rp</span><span class="op">)</span></span></code></pre><p></p></div>
<div class="asciicast" style="color: #172431;font-family: 'Fira Code',Monaco,Consolas,Menlo,'Bitstream Vera Sans Mono','Powerline Symbols',monospace;line-height: 1.300000"><div class="sourceCode"><pre>
#&gt;  [1] "as_ps_handle"          "clone"                 "finalize"
#&gt;  [4] "format"                "get_cmdline"           "get_cpu_times"
#&gt;  [7] "get_error_connection"  "get_error_file"        "get_exe"
#&gt; [10] "get_exit_status"       "get_input_connection"  "get_input_file"
#&gt; [13] "get_memory_info"       "get_name"              "get_output_connection"
#&gt; [16] "get_output_file"       "get_pid"               "get_poll_connection"
#&gt; [19] "get_result"            "get_start_time"        "get_status"
#&gt; [22] "get_username"          "get_wd"                "has_error_connection"
#&gt; [25] "has_input_connection"  "has_output_connection" "has_poll_connection"
#&gt; [28] "initialize"            "interrupt"             "is_alive"
#&gt; [31] "is_incomplete_error"   "is_incomplete_output"  "is_supervised"
#&gt; [34] "kill"                  "kill_tree"             "poll_io"
#&gt; [37] "print"                 "read_all_error"        "read_all_error_lines"
#&gt; [40] "read_all_output"       "read_all_output_lines" "read_error"
#&gt; [43] "read_error_lines"      "read_output"           "read_output_lines"
#&gt; [46] "resume"                "signal"                "supervise"
#&gt; [49] "suspend"               "wait"                  "write_input"
</pre></div></div>

<p>These include all methods of the <code><a href="http://processx.r-lib.org/reference/process.html" class="external-link">processx::process</a></code> superclass and the new <code><a href="get_result.html">get_result()</a></code> method, to retrieve the R object returned by the function call.
Some of the handiest methods are:</p><ul><li><p><code>get_exit_status()</code> to query the exit status of a finished process.</p></li>
<li><p><code><a href="get_result.html">get_result()</a></code> to collect the return value of the R function call.</p></li>
<li><p><code>interrupt()</code> to send an interrupt to the process. This is equivalent to a <code>CTRL+C</code> key press, and the R process might ignore it.</p></li>
<li><p><code>is_alive()</code> to check if the process is alive.</p></li>
<li><p><code>kill()</code> to terminate the process.</p></li>
<li><p><code>poll_io()</code> to wait for any standard output, standard error, or the completion of the process, with a timeout.</p></li>
<li><p><code>read_*()</code> to read the standard output or error.</p></li>
<li><p><code>suspend()</code> and <code>resume()</code> to stop and continue a process.</p></li>
<li><p><code>wait()</code> to wait for the completion of the process, with a timeout.</p></li>
</ul></div>

<div class="section">
<h3 id="multiple-background-r-processes-and-poll-">Multiple background R processes and <code><a href="http://processx.r-lib.org/reference/poll.html" class="external-link">poll()</a></code><a class="anchor" aria-label="anchor" href="#multiple-background-r-processes-and-poll-"></a></h3>


<p>Multiple background R processes are best managed with the <code><a href="http://processx.r-lib.org/reference/poll.html" class="external-link">processx::poll()</a></code> function that waits for events (standard output/error or termination) from multiple processes.
It returns as soon as one process has generated an event, or if its timeout has expired.
The timeout is in milliseconds.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">rp1</span> <span class="op">&lt;-</span> <span class="fu">callr</span><span class="fu">::</span><span class="fu"><a href="../reference/r_bg.html">r_bg</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span>; <span class="st">"1 done"</span> <span class="op">}</span><span class="op">)</span></span>
<span><span class="va">rp2</span> <span class="op">&lt;-</span> <span class="fu">callr</span><span class="fu">::</span><span class="fu"><a href="../reference/r_bg.html">r_bg</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">1000</span><span class="op">)</span>; <span class="st">"2 done"</span> <span class="op">}</span><span class="op">)</span></span>
<span><span class="fu">processx</span><span class="fu">::</span><span class="fu"><a href="http://processx.r-lib.org/reference/poll.html" class="external-link">poll</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">rp1</span>, <span class="va">rp2</span><span class="op">)</span>, <span class="fl">1000</span><span class="op">)</span></span></code></pre><p></p></div>
<div class="asciicast" style="color: #172431;font-family: 'Fira Code',Monaco,Consolas,Menlo,'Bitstream Vera Sans Mono','Powerline Symbols',monospace;line-height: 1.300000"><div class="sourceCode"><pre>
#&gt; [[1]]
#&gt;   output    error  process
#&gt; "silent" "silent" "silent"
#&gt;
#&gt; [[2]]
#&gt;  output   error process
#&gt; "ready" "ready" "ready"
#&gt;
</pre></div></div>

<p></p><div class="sourceCode r"><pre><code><span><span class="va">rp2</span><span class="op">$</span><span class="fu">get_result</span><span class="op">(</span><span class="op">)</span></span></code></pre><p></p></div>
<div class="asciicast" style="color: #172431;font-family: 'Fira Code',Monaco,Consolas,Menlo,'Bitstream Vera Sans Mono','Powerline Symbols',monospace;line-height: 1.300000"><div class="sourceCode"><pre>
#&gt; [1] "2 done"
</pre></div></div>

<p></p><div class="sourceCode r"><pre><code><span><span class="fu">processx</span><span class="fu">::</span><span class="fu"><a href="http://processx.r-lib.org/reference/poll.html" class="external-link">poll</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">rp1</span><span class="op">)</span>, <span class="fl">1000</span><span class="op">)</span></span></code></pre><p></p></div>
<div class="asciicast" style="color: #172431;font-family: 'Fira Code',Monaco,Consolas,Menlo,'Bitstream Vera Sans Mono','Powerline Symbols',monospace;line-height: 1.300000"><div class="sourceCode"><pre>
#&gt; [[1]]
#&gt;   output    error  process
#&gt; "silent" "silent"  "ready"
#&gt;
</pre></div></div>

<p></p><div class="sourceCode r"><pre><code><span><span class="va">rp1</span><span class="op">$</span><span class="fu">get_result</span><span class="op">(</span><span class="op">)</span></span></code></pre><p></p></div>
<div class="asciicast" style="color: #172431;font-family: 'Fira Code',Monaco,Consolas,Menlo,'Bitstream Vera Sans Mono','Powerline Symbols',monospace;line-height: 1.300000"><div class="sourceCode"><pre>
#&gt; [1] "1 done"
</pre></div></div>
</div>

<div class="section">
<h3 id="persistent-r-sessions">Persistent R sessions<a class="anchor" aria-label="anchor" href="#persistent-r-sessions"></a></h3>


<p><code>r_session</code> is another <code><a href="http://processx.r-lib.org/reference/process.html" class="external-link">processx::process</a></code> subclass that represents a persistent background R session:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">rs</span> <span class="op">&lt;-</span> <span class="fu">callr</span><span class="fu">::</span><span class="va"><a href="../reference/r_session.html">r_session</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">rs</span></span></code></pre><p></p></div>
<div class="asciicast" style="color: #172431;font-family: 'Fira Code',Monaco,Consolas,Menlo,'Bitstream Vera Sans Mono','Powerline Symbols',monospace;line-height: 1.300000"><div class="sourceCode"><pre>
#&gt; R SESSION, alive, idle, pid 58288.
</pre></div></div>

<p><code>r_session$run()</code> is a synchronous call, that works similarly to <code><a href="r.html">r()</a></code>, but uses the persistent session.
<code>r_session$call()</code> starts the function call and returns immediately.
The <code>r_session$poll_process()</code> method or <code><a href="http://processx.r-lib.org/reference/poll.html" class="external-link">processx::poll()</a></code> can then be used to wait for the completion or other events from one or more R sessions, R processes or other <code><a href="http://processx.r-lib.org/reference/process.html" class="external-link">processx::process</a></code> objects.</p>
<p>Once an R session is done with an asynchronous computation, its <code>poll_process()</code> method returns <code>"ready"</code> and the <code>r_session$read()</code> method can read out the result.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">rs</span> <span class="op">&lt;-</span> <span class="fu">callr</span><span class="fu">::</span><span class="va"><a href="../reference/r_session.html">r_session</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">rs</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></code></pre><p></p></div>
<div class="asciicast" style="color: #172431;font-family: 'Fira Code',Monaco,Consolas,Menlo,'Bitstream Vera Sans Mono','Powerline Symbols',monospace;line-height: 1.300000"><div class="sourceCode"><pre>
#&gt;  [1] 0.8047354 0.8938617 0.7142338 0.8505395 0.3118376 0.7083882 0.9514367
#&gt;  [8] 0.2536755 0.6727270 0.3359578
</pre></div></div>

<p></p><div class="sourceCode r"><pre><code><span><span class="va">rs</span><span class="op">$</span><span class="fu">call</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rs</span></span></code></pre><p></p></div>
<div class="asciicast" style="color: #172431;font-family: 'Fira Code',Monaco,Consolas,Menlo,'Bitstream Vera Sans Mono','Powerline Symbols',monospace;line-height: 1.300000"><div class="sourceCode"><pre>
#&gt; R SESSION, alive, busy, pid 58294.
</pre></div></div>

<p></p><div class="sourceCode r"><pre><code><span><span class="va">rs</span><span class="op">$</span><span class="fu">poll_process</span><span class="op">(</span><span class="fl">2000</span><span class="op">)</span></span></code></pre><p></p></div>
<div class="asciicast" style="color: #172431;font-family: 'Fira Code',Monaco,Consolas,Menlo,'Bitstream Vera Sans Mono','Powerline Symbols',monospace;line-height: 1.300000"><div class="sourceCode"><pre>
#&gt; [1] "ready"
</pre></div></div>

<p></p><div class="sourceCode r"><pre><code><span><span class="va">rs</span><span class="op">$</span><span class="fu">read</span><span class="op">(</span><span class="op">)</span></span></code></pre><p></p></div>
<div class="asciicast" style="color: #172431;font-family: 'Fira Code',Monaco,Consolas,Menlo,'Bitstream Vera Sans Mono','Powerline Symbols',monospace;line-height: 1.300000"><div class="sourceCode"><pre>
#&gt; $code
#&gt; [1] 200
#&gt;
#&gt; $message
#&gt; [1] "done callr-rs-result-e3324ebebc8b"
#&gt;
#&gt; $result
#&gt;  [1] -0.60962697 -0.41063130  0.22121432  1.44621900  0.26890394  0.11432756
#&gt;  [7] -0.53206118  0.47493933  0.02069551  1.37348004
#&gt;
#&gt; $stdout
#&gt; [1] ""
#&gt;
#&gt; $stderr
#&gt; [1] ""
#&gt;
#&gt; $error
#&gt; NULL
#&gt;
#&gt; attr(,"class")
#&gt; [1] "callr_session_result"
</pre></div></div>
</div>

<div class="section">
<h3 id="running-r-cmd-commands">Running <code>R CMD</code> commands<a class="anchor" aria-label="anchor" href="#running-r-cmd-commands"></a></h3>


<p>The <code><a href="rcmd.html">rcmd()</a></code> function calls an <code>R CMD</code> command.
For example, you can call <code>R CMD INSTALL</code>, <code>R CMD check</code> or <code>R CMD config</code> this way:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu">callr</span><span class="fu">::</span><span class="fu"><a href="../reference/rcmd.html">rcmd</a></span><span class="op">(</span><span class="st">"config"</span>, <span class="st">"CC"</span><span class="op">)</span></span></code></pre><p></p></div>
<div class="asciicast" style="color: #172431;font-family: 'Fira Code',Monaco,Consolas,Menlo,'Bitstream Vera Sans Mono','Powerline Symbols',monospace;line-height: 1.300000"><div class="sourceCode"><pre>
#&gt; $status
#&gt; [1] 0
#&gt;
#&gt; $stdout
#&gt; [1] "clang -arch arm64\n"
#&gt;
#&gt; $stderr
#&gt; [1] ""
#&gt;
#&gt; $timeout
#&gt; [1] FALSE
#&gt;
#&gt; $command
#&gt; [1] "/Library/Frameworks/R.framework/Versions/4.2-arm64/Resources/bin/R"
#&gt; [2] "CMD"
#&gt; [3] "config"
#&gt; [4] "CC"
#&gt;
</pre></div></div>

<p>This returns a list with three components: the standard output, the standard error, and the exit (status) code of the <code>R CMD</code> command.</p>
</div>

<div class="section">
<h3 id="configuration">Configuration<a class="anchor" aria-label="anchor" href="#configuration"></a></h3>

<div class="section">
<h4 id="environment-variables">Environment variables<a class="anchor" aria-label="anchor" href="#environment-variables"></a></h4>

<ul><li><p><code>CALLR_NO_TEMP_DLLS</code>: If <code>true</code>, then callr does not use a temporary
directory to copy the client DLL files from, in the subprocess. By
default callr copies the DLL file that drives the callr subprocess into
a temporary directory and loads it from there. This is mainly to avoid
locking a DLL file in the package library, on Windows. If this default
causes issues for you, set it to <code>true</code>, and then callr will use the DLL
file from the installed processx package. See also
https://github.com/r-lib/callr/issues/273.</p></li>
</ul></div>


</div>

<div class="section">
<h3 id="code-of-conduct">Code of Conduct<a class="anchor" aria-label="anchor" href="#code-of-conduct"></a></h3>


<p>Please note that the callr project is released with a
<a href="https://callr.r-lib.org/CODE_OF_CONDUCT.html">Contributor Code of Conduct</a>.
By contributing to this project, you agree to abide by its terms.</p>
</div>

    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Useful links:</p><ul><li><p><a href="https://callr.r-lib.org">https://callr.r-lib.org</a></p></li>
<li><p><a href="https://github.com/r-lib/callr" class="external-link">https://github.com/r-lib/callr</a></p></li>
<li><p>Report bugs at <a href="https://github.com/r-lib/callr/issues" class="external-link">https://github.com/r-lib/callr/issues</a></p></li>
</ul></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p><strong>Maintainer</strong>: Gábor Csárdi <a href="mailto:csardi.gabor@gmail.com">csardi.gabor@gmail.com</a> (<a href="https://orcid.org/0000-0001-7098-9676" class="external-link">ORCID</a>) [copyright holder]</p>
<p>Authors:</p><ul><li><p>Winston Chang</p></li>
</ul><p>Other contributors:</p><ul><li><p>Posit Software, PBC [copyright holder, funder]</p></li>
<li><p>Ascent Digital Services [copyright holder, funder]</p></li>
</ul></div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/gaborcsardi" class="external-link">Gábor Csárdi</a>, <a href="https://github.com/wch" class="external-link">Winston Chang</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>, Ascent Digital Services.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

  </div></footer></body></html>

